using System.Net.Http;
using System.Threading.Tasks;
using Microsoft.Extensions.Configuration;
using NbaStats.Worker.Models;
using Newtonsoft.Json;
using Quartz;
using Serilog;
using NbaStats;

namespace NbaStats.Worker.Jobs
{
    public class ExampleJob: IJob
    {
        public string ResponseJson = "[\n{\n\"GameID\": 17903,\n\"Season\": 2022,\n\"SeasonType\": 1,\n\"Status\": \"Final\",\n\"Day\": \"2022-04-09T00:00:00\",\n\"DateTime\": \"2022-04-09T21:30:00\",\n\"AwayTeam\": \"SAC\",\n\"HomeTeam\": \"LAC\",\n\"AwayTeamID\": 30,\n\"HomeTeamID\": 28,\n\"StadiumID\": 27,\n\"Channel\": \"BSSC\",\n\"Attendance\": null,\n\"AwayTeamScore\": 120,\n\"HomeTeamScore\": 143,\n\"Updated\": \"2022-04-09T23:55:14\",\n\"Quarter\": null,\n\"TimeRemainingMinutes\": null,\n\"TimeRemainingSeconds\": null,\n\"PointSpread\": -14.1,\n\"OverUnder\": 275.2,\n\"AwayTeamMoneyLine\": 625,\n\"HomeTeamMoneyLine\": -874,\n\"GlobalGameID\": 20017903,\n\"GlobalAwayTeamID\": 20000030,\n\"GlobalHomeTeamID\": 20000028,\n\"PointSpreadAwayTeamMoneyLine\": -135,\n\"PointSpreadHomeTeamMoneyLine\": -135,\n\"LastPlay\": \"Scrambled\",\n\"IsClosed\": true,\n\"GameEndDateTime\": \"2022-04-09T23:50:41\",\n\"HomeRotationNumber\": 656,\n\"AwayRotationNumber\": 654,\n\"NeutralVenue\": false,\n\"OverPayout\": -133,\n\"UnderPayout\": -138,\n\"CrewChiefID\": 20000020,\n\"UmpireID\": 20000061,\n\"RefereeID\": 20000065,\n\"AlternateID\": null,\n\"DateTimeUTC\": \"2022-04-10T01:30:00\",\n\"SeriesInfo\": null,\n\"Quarters\": [\n{\n\"QuarterID\": 69176,\n\"GameID\": 17903,\n\"Number\": 1,\n\"Name\": \"1\",\n\"AwayScore\": 20,\n\"HomeScore\": 38\n},\n{\n\"QuarterID\": 69177,\n\"GameID\": 17903,\n\"Number\": 2,\n\"Name\": \"2\",\n\"AwayScore\": 35,\n\"HomeScore\": 34\n},\n{\n\"QuarterID\": 69178,\n\"GameID\": 17903,\n\"Number\": 3,\n\"Name\": \"3\",\n\"AwayScore\": 32,\n\"HomeScore\": 40\n},\n{\n\"QuarterID\": 69179,\n\"GameID\": 17903,\n\"Number\": 4,\n\"Name\": \"4\",\n\"AwayScore\": 33,\n\"HomeScore\": 31\n}\n]\n},\n{\n\"GameID\": 17904,\n\"Season\": 2022,\n\"SeasonType\": 1,\n\"Status\": \"Final\",\n\"Day\": \"2022-04-09T00:00:00\",\n\"DateTime\": \"2022-04-09T13:00:00\",\n\"AwayTeam\": \"IND\",\n\"HomeTeam\": \"PHI\",\n\"AwayTeamID\": 13,\n\"HomeTeamID\": 7,\n\"StadiumID\": 7,\n\"Channel\": \"NSPA\",\n\"Attendance\": null,\n\"AwayTeamScore\": 147,\n\"HomeTeamScore\": 163,\n\"Updated\": \"2022-04-09T15:34:37\",\n\"Quarter\": null,\n\"TimeRemainingMinutes\": null,\n\"TimeRemainingSeconds\": null,\n\"PointSpread\": -17.7,\n\"OverUnder\": 289.9,\n\"AwayTeamMoneyLine\": 999,\n\"HomeTeamMoneyLine\": -1745,\n\"GlobalGameID\": 20017904,\n\"GlobalAwayTeamID\": 20000013,\n\"GlobalHomeTeamID\": 20000007,\n\"PointSpreadAwayTeamMoneyLine\": -135,\n\"PointSpreadHomeTeamMoneyLine\": -136,\n\"LastPlay\": \"Scrambled\",\n\"IsClosed\": true,\n\"GameEndDateTime\": \"2022-04-09T15:30:44\",\n\"HomeRotationNumber\": 653,\n\"AwayRotationNumber\": 652,\n\"NeutralVenue\": false,\n\"OverPayout\": -132,\n\"UnderPayout\": -138,\n\"CrewChiefID\": 20000066,\n\"UmpireID\": 20000011,\n\"RefereeID\": 20000062,\n\"AlternateID\": null,\n\"DateTimeUTC\": \"2022-04-09T17:00:00\",\n\"SeriesInfo\": null,\n\"Quarters\": [\n{\n\"QuarterID\": 69164,\n\"GameID\": 17904,\n\"Number\": 1,\n\"Name\": \"1\",\n\"AwayScore\": 28,\n\"HomeScore\": 45\n},\n{\n\"QuarterID\": 69165,\n\"GameID\": 17904,\n\"Number\": 2,\n\"Name\": \"2\",\n\"AwayScore\": 38,\n\"HomeScore\": 35\n},\n{\n\"QuarterID\": 69166,\n\"GameID\": 17904,\n\"Number\": 3,\n\"Name\": \"3\",\n\"AwayScore\": 44,\n\"HomeScore\": 42\n},\n{\n\"QuarterID\": 69167,\n\"GameID\": 17904,\n\"Number\": 4,\n\"Name\": \"4\",\n\"AwayScore\": 37,\n\"HomeScore\": 40\n}\n]\n},\n{\n\"GameID\": 17905,\n\"Season\": 2022,\n\"SeasonType\": 1,\n\"Status\": \"Final\",\n\"Day\": \"2022-04-09T00:00:00\",\n\"DateTime\": \"2022-04-09T18:00:00\",\n\"AwayTeam\": \"NO\",\n\"HomeTeam\": \"MEM\",\n\"AwayTeamID\": 23,\n\"HomeTeamID\": 21,\n\"StadiumID\": 21,\n\"Channel\": \"NBATV\",\n\"Attendance\": null,\n\"AwayTeamScore\": 139,\n\"HomeTeamScore\": 172,\n\"Updated\": \"2022-04-09T20:28:01\",\n\"Quarter\": null,\n\"TimeRemainingMinutes\": null,\n\"TimeRemainingSeconds\": null,\n\"PointSpread\": -9.8,\n\"OverUnder\": 281.3,\n\"AwayTeamMoneyLine\": 318,\n\"HomeTeamMoneyLine\": -406,\n\"GlobalGameID\": 20017905,\n\"GlobalAwayTeamID\": 20000023,\n\"GlobalHomeTeamID\": 20000021,\n\"PointSpreadAwayTeamMoneyLine\": -135,\n\"PointSpreadHomeTeamMoneyLine\": -135,\n\"LastPlay\": \"Scrambled\",\n\"IsClosed\": true,\n\"GameEndDateTime\": \"2022-04-09T20:22:57\",\n\"HomeRotationNumber\": 658,\n\"AwayRotationNumber\": 657,\n\"NeutralVenue\": false,\n\"OverPayout\": -135,\n\"UnderPayout\": -135,\n\"CrewChiefID\": 20000003,\n\"UmpireID\": 20000015,\n\"RefereeID\": 20000033,\n\"AlternateID\": null,\n\"DateTimeUTC\": \"2022-04-09T22:00:00\",\n\"SeriesInfo\": null,\n\"Quarters\": [\n{\n\"QuarterID\": 69168,\n\"GameID\": 17905,\n\"Number\": 1,\n\"Name\": \"1\",\n\"AwayScore\": 22,\n\"HomeScore\": 37\n},\n{\n\"QuarterID\": 69169,\n\"GameID\": 17905,\n\"Number\": 2,\n\"Name\": \"2\",\n\"AwayScore\": 35,\n\"HomeScore\": 42\n},\n{\n\"QuarterID\": 69170,\n\"GameID\": 17905,\n\"Number\": 3,\n\"Name\": \"3\",\n\"AwayScore\": 40,\n\"HomeScore\": 67\n},\n{\n\"QuarterID\": 69171,\n\"GameID\": 17905,\n\"Number\": 4,\n\"Name\": \"4\",\n\"AwayScore\": 42,\n\"HomeScore\": 27\n}\n]\n},\n{\n\"GameID\": 17906,\n\"Season\": 2022,\n\"SeasonType\": 1,\n\"Status\": \"Final\",\n\"Day\": \"2022-04-09T00:00:00\",\n\"DateTime\": \"2022-04-09T20:30:00\",\n\"AwayTeam\": \"GS\",\n\"HomeTeam\": \"SA\",\n\"AwayTeamID\": 26,\n\"HomeTeamID\": 24,\n\"StadiumID\": 24,\n\"Channel\": \"NBATV\",\n\"Attendance\": null,\n\"AwayTeamScore\": 122,\n\"HomeTeamScore\": 115,\n\"Updated\": \"2022-04-09T23:13:47\",\n\"Quarter\": null,\n\"TimeRemainingMinutes\": null,\n\"TimeRemainingSeconds\": null,\n\"PointSpread\": 11.2,\n\"OverUnder\": 267.2,\n\"AwayTeamMoneyLine\": -375,\n\"HomeTeamMoneyLine\": 297,\n\"GlobalGameID\": 20017906,\n\"GlobalAwayTeamID\": 20000026,\n\"GlobalHomeTeamID\": 20000024,\n\"PointSpreadAwayTeamMoneyLine\": -135,\n\"PointSpreadHomeTeamMoneyLine\": -135,\n\"LastPlay\": \"Scrambled\",\n\"IsClosed\": true,\n\"GameEndDateTime\": \"2022-04-09T22:57:18\",\n\"HomeRotationNumber\": 660,\n\"AwayRotationNumber\": 659,\n\"NeutralVenue\": false,\n\"OverPayout\": -137,\n\"UnderPayout\": -133,\n\"CrewChiefID\": 20000017,\n\"UmpireID\": 20000071,\n\"RefereeID\": 20000056,\n\"AlternateID\": null,\n\"DateTimeUTC\": \"2022-04-10T00:30:00\",\n\"SeriesInfo\": null,\n\"Quarters\": [\n{\n\"QuarterID\": 69172,\n\"GameID\": 17906,\n\"Number\": 1,\n\"Name\": \"1\",\n\"AwayScore\": 28,\n\"HomeScore\": 26\n},\n{\n\"QuarterID\": 69173,\n\"GameID\": 17906,\n\"Number\": 2,\n\"Name\": \"2\",\n\"AwayScore\": 38,\n\"HomeScore\": 28\n},\n{\n\"QuarterID\": 69174,\n\"GameID\": 17906,\n\"Number\": 3,\n\"Name\": \"3\",\n\"AwayScore\": 29,\n\"HomeScore\": 33\n},\n{\n\"QuarterID\": 69175,\n\"GameID\": 17906,\n\"Number\": 4,\n\"Name\": \"4\",\n\"AwayScore\": 27,\n\"HomeScore\": 28\n}\n]\n}\n]";

        public Task Execute(IJobExecutionContext context)
        {
             JobDataMap dataMap = context.MergedJobDataMap;
             HttpClient client = (HttpClient) dataMap["httpClient"];
             IConfiguration configuration = (IConfiguration) dataMap["configuration"];

             var dbManager = new DbManager(configuration);
             
             dbManager.GetGames();
             
             var result = JsonConvert.DeserializeObject(ResponseJson);

             Log.Information("Executing the HelloJob with serilog");
             return Task.CompletedTask;
        }
    }
}